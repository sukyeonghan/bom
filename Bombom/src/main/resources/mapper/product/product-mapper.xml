<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="product">
	<resultMap type="product" id="productMap">
		<result property="pdtNo" column="pdt_no"/>
		<result property="pdtCategory" column="pdt_category"/>
		<result property="pdtPrice" column="pdt_price"/>
		<result property="pdtName" column="pdt_name"/>
		<result property="pdtIntro" column="pdt_intro"/>
		<result property="pdtStatus" column="pdt_status"/>
		<result property="pdtDate" column="pdt_date"/>
		<result property="pdtDetailImage" column="pdt_detail_image"/>
		<result property="eventNoRef" column="event_no_ref"/>
		<result property="thumbs" column="thumbs"/>
		<result property="salePer" column="event_sale_per"/>
	</resultMap>
	<resultMap type="option" id="optionMap">
		<result property="pdtOptionNo" column="pdt_option_no"/>
		<result property="pdtNo" column="pdt_no_ref"/>
		<result property="pdtOptionContent" column="pdt_option_content"/>
		<result property="pdtOptionAddprice" column="pdt_option_addprice" />
	</resultMap>
	<resultMap type="thumb" id="thumbMap">
		<result property="pdtThumbNo" column="pdt_thumb_no"/>
		<result property="pdtNo" column="pdt_no_ref"/>
		<result property="pdtThumbImage" column="pdt_thumb_image"/>
	</resultMap>
	
	<select id="count" resultType="_int" parameterType="map">
		SELECT COUNT(*) FROM PRODUCT
		<if test="category != '전체'">
			WHERE PDT_CATEGORY=#{category}
		</if>
	</select>
	<select id="cateCount" resultType="_int" parameterType="string">
		SELECT COUNT(*) FROM PRODUCT WHERE PDT_CATEGORY=#{pdtCategory}
	</select>
	<select id="productList" resultMap="productMap" parameterType="map">
		SELECT DISTINCT PDT_NO,PDT_CATEGORY,PDT_PRICE,PDT_NAME,PDT_STATUS,PDT_DATE,EVENT_NO_REF,E.EVENT_SALE_PER,
    		LISTAGG(PDT_THUMB_IMAGE,',') WITHIN GROUP(ORDER BY pdt_no_ref) OVER(PARTITION BY PDT_NO_REF)AS THUMBS
		FROM PRODUCT
			JOIN  PRODUCT_THUMB ON(PDT_NO=PDT_NO_REF) 
			LEFT JOIN EVENT E ON(EVENT_NO_REF=EVENT_NO)
		<if test="category != '전체'">
			WHERE PDT_CATEGORY IN(#{category})
		</if>
		<if test="sort == '등록일순'">
			ORDER BY PDT_DATE DESC
		</if>
		<if test="sort == '낮은가격순'">
			ORDER BY PDT_PRICE
		</if>
		<if test="sort == '높은가격순'">
			ORDER BY PDT_PRICE DESC
		</if>
		
	</select>
	<!-- 카테고리별 제품 리스트 -->
	<select id="cateProductList" resultMap="productMap" parameterType="string">
		SELECT DISTINCT PDT_NO,PDT_CATEGORY,PDT_PRICE,PDT_NAME,PDT_STATUS,PDT_DATE,EVENT_NO_REF,E.EVENT_SALE_PER,
    		LISTAGG(PDT_THUMB_IMAGE,',') WITHIN GROUP(ORDER BY pdt_no_ref) OVER(PARTITION BY PDT_NO_REF)AS THUMBS
		FROM PRODUCT 
			JOIN  PRODUCT_THUMB ON(PDT_NO=PDT_NO_REF) 
			LEFT JOIN EVENT E ON(EVENT_NO_REF=EVENT_NO)
		WHERE PDT_CATEGORY IN(#{pdtCategory})
		ORDER BY PDT_DATE DESC
	</select>
	<!-- 7일 이내로 등록한 전체 상품 리스트 -->
	<select id="newList" resultMap="productMap">
		SELECT PDT_NO,PDT_DATE FROM PRODUCT WHERE PDT_DATE>SYSDATE-7
	</select>
	<!-- 7일 이내로 등록한 카테고리별 상품 리스트 -->
	<select id="newCateList" resultMap="productMap">
		SELECT PDT_NO,PDT_DATE FROM PRODUCT WHERE PDT_DATE>SYSDATE-7 AND PDT_CATEGORY=#{pdtCategory}
	</select>
</mapper>
